import { get, post } from "./axios-config";

type TBaseResponse<T> = {
  code: number;
  message: string;
  data: T;
};

type TAssignedTasksResponse = TBaseResponse<TAssignedTasksData[]>;

export type TAssignedTasksData = {
  taskId: number;
  assignedAt: string;
  dueDate: string;
  taskStatus: string;
  vulnerability: TAssignedTasksDataVul;
};

type TAssignedTasksDataVul = {
  id: number;
  description: string;
  severity: string;
  url: string;
  actionReason: string;
  vulnerabilityStatus: string;
  project: TAssignedTasksDataVulProject;
};

type TAssignedTasksDataVulProject = {
  id: number;
  name: string;
  statusId: number;
};

type TPentesterTaskHistoryResponse = TBaseResponse<TPentesterTaskHistoryData[]>;

type TPentesterTaskHistoryData = {
  taskId: number,
  assignedAt: string,
  dueDate: string,
  status: string,
  report: string,
  fixedAt: string,
  rejectReason: string
  vulnerability: TPentesterTaskHistoryVulData
}

type TPentesterTaskHistoryVulData = {
  vulnerabilityId: number,
  description: string,
  severity: string,
  url: string,
  project: {
    projectId: number,
    projectName: string
  }
}

export async function getAssignedTasks() {
  return await get<TAssignedTasksResponse>({
    url: `/Pentester/GetAssignedTasks`,
  });
}

export async function getAcceptedAssignedTasks() {
  return await get<TAssignedTasksResponse>({
    url: `/Pentester/GetAcceptedAssignedTasks`,
  });
}

export async function acceptVulnerabilities({
  vulId,
  reason,
}: {
  vulId: number;
  reason: string;
}) {
  return await post({
    url: `/Pentester/AcceptVulnerabilities`,
    data: {
      acceptedVulnerabilityIds: [vulId],
      acceptedReason: reason,
    },
  });
}

export async function rejectVulnerabilities({
  vulId,
  reason,
}: {
  vulId: number;
  reason: string;
}) {
  return await post({
    url: `/Pentester/RejectVulnerabilities`,
    data: {
      rejectedVulnerabilities: [
        {
          vulnerabilityId: vulId,
          reason: reason,
        },
      ],
    },
  });
}

export async function updateTaskStatus({taskId, statusId, reason} : {taskId: number, statusId: number, reason: string}) {
  return await post({
    url: `/Pentester/UpdateTaskStatus/${taskId}`,
    data: {
      statusId: statusId,
      reason: reason,
      actionReason: reason
    }
  })
}

export async function getPentesterTaskHistory() {
  return await get<TPentesterTaskHistoryResponse>({
    url: "/Pentester/GetPentesterTaskHistory",
  })
}